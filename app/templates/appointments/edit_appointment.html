{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">Edit Appointment</h3>
            </div>
            <div class="card-body">
                <!-- Current Appointment Info -->
                <div class="alert alert-info">
                    <h6>Appointment Details:</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Customer:</strong> {{ appointment.customer.first_name }} {{ appointment.customer.last_name }}<br>
                            <strong>Stylist:</strong> {{ appointment.stylist.first_name }} {{ appointment.stylist.last_name }}<br>
                            <strong>Service:</strong> {{ appointment.service.name }}
                        </div>
                        <div class="col-md-6">
                            <strong>Date:</strong> {{ appointment.appointment_date.strftime('%A, %B %d, %Y') }}<br>
                            <strong>Time:</strong> {{ appointment.start_time.strftime('%I:%M %p') }} - {{ appointment.end_time.strftime('%I:%M %p') }}<br>
                            <strong>Current Status:</strong> 
                            <span class="badge bg-{{ 'success' if appointment.status == 'confirmed' else 'secondary' if appointment.status == 'completed' else 'danger' if appointment.status == 'cancelled' else 'warning' }}">
                                {{ appointment.status.title() }}
                            </span>
                        </div>
                    </div>
                </div>
                
                <form method="POST">
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ form.status.label(class="form-label") }}
                        {{ form.status(class="form-select") }}
                        {% if form.status.errors %}
                            <div class="text-danger">
                                {% for error in form.status.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.notes.label(class="form-label") }}
                        {{ form.notes(class="form-control", rows="4", placeholder="Add any notes about this appointment...") }}
                        {% if form.notes.errors %}
                            <div class="text-danger">
                                {% for error in form.notes.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('appointments.view_appointment', appointment_id=appointment.id) }}" 
                           class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </a>
                        {{ form.submit(class="btn btn-warning") }}
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Status History -->
        {% if appointment.status_history %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Status History</h5>
            </div>
            <div class="card-body">
                <div class="timeline">
                    {% for status in appointment.status_history|sort(attribute='changed_at', reverse=true) %}
                    <div class="timeline-item">
                        <div class="timeline-marker bg-{{ 'success' if status.status == 'confirmed' else 'secondary' if status.status == 'completed' else 'danger' if status.status == 'cancelled' else 'warning' }}"></div>
                        <div class="timeline-content">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1">{{ status.status.title() }}</h6>
                                    <p class="mb-1 text-muted">Changed by {{ status.changed_by.first_name }} {{ status.changed_by.last_name }}</p>
                                    {% if status.notes %}
                                        <p class="mb-0">{{ status.notes }}</p>
                                    {% endif %}
                                </div>
                                <small class="text-muted">{{ status.changed_at.strftime('%B %d, %Y at %I:%M %p') }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -35px;
    top: 5px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 2px #dee2e6;
}

.timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: -29px;
    top: 17px;
    width: 2px;
    height: calc(100% + 3px);
    background-color: #dee2e6;
}

.timeline-content {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}
</style>
{% endblock %} 