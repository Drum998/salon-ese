Chris.Stephens@FF-DT-08 c:\devroot\salon-ese                                                                                                                                                                            
# docker exec -it salon-ese-web-1 python -m pytest tests/ -v --tb=short --cov=app                                                                                                                                       
================================================================================================= test session starts ==================================================================================================
platform linux -- Python 3.9.23, pytest-8.0.0, pluggy-1.6.0 -- /usr/local/bin/python                                                                                                                                    
cachedir: .pytest_cache                                                                                                                                                                                                 
rootdir: /app                                                                                                                                                                                                           
configfile: pytest.ini                                                                                                                                                                                                  
plugins: flask-1.3.0, cov-4.1.0                                                                                                                                                                                         
collected 50 items                                                                                                                                                                                                      
                                                                                                                                                                                                                        
tests/test_auth.py::test_register_page PASSED                                                                                                                                                                    [  2%] 
tests/test_auth.py::test_login_page PASSED                                                                                                                                                                       [  4%] 
tests/test_auth.py::test_user_registration PASSED                                                                                                                                                                [  6%] 
tests/test_auth.py::test_first_user_becomes_owner PASSED                                                                                                                                                         [  8%] 
tests/test_auth.py::test_user_login PASSED                                                                                                                                                                       [ 10%] 
tests/test_auth.py::test_invalid_login PASSED                                                                                                                                                                    [ 12%] 
tests/test_employment_details.py::TestEmploymentDetailsModel::test_employment_details_creation_employed PASSED                                                                                                   [ 14%] 
tests/test_employment_details.py::TestEmploymentDetailsModel::test_employment_details_creation_self_employed PASSED                                                                                              [ 16%] 
tests/test_employment_details.py::TestEmploymentDetailsModel::test_unique_user_constraint PASSED                                                                                                                 [ 18%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_valid_employed_form PASSED                                                                                                                     [ 20%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_valid_self_employed_form PASSED                                                                                                                [ 22%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_commission_required_for_self_employed PASSED                                                                                                   [ 24%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_commission_not_allowed_for_employed FAILED                                                                                                     [ 26%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_invalid_commission_percentage FAILED                                                                                                           [ 28%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_negative_commission_percentage FAILED                                                                                                          [ 30%] 
tests/test_employment_details.py::TestEmploymentDetailsForm::test_duplicate_user_validation PASSED                                                                                                               [ 32%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_employment_details_page_access_denied PASSED                                                                                            [ 34%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_employment_details_page_requires_manager_role PASSED                                                                                    [ 36%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_new_employment_details_page PASSED                                                                                                      [ 38%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_create_employed_details PASSED                                                                                                          [ 40%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_create_self_employed_details PASSED                                                                                                     [ 42%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_edit_employment_details FAILED                                                                                                          [ 44%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_delete_employment_details PASSED                                                                                                        [ 46%] 
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_employment_details_form_validation_error PASSED                                                                                         [ 48%] 
tests/test_salon_settings.py::TestSalonSettingsModel::test_salon_settings_creation PASSED                                                                                                                        [ 50%] 
tests/test_salon_settings.py::TestSalonSettingsModel::test_get_settings_creates_default PASSED                                                                                                                   [ 52%] 
tests/test_salon_settings.py::TestSalonSettingsModel::test_get_settings_returns_existing PASSED                                                                                                                  [ 54%] 
tests/test_salon_settings.py::TestSalonSettingsForm::test_valid_salon_settings_form PASSED                                                                                                                       [ 56%] 
tests/test_salon_settings.py::TestSalonSettingsForm::test_invalid_time_format FAILED                                                                                                                             [ 58%] 
tests/test_salon_settings.py::TestSalonSettingsForm::test_closed_day_validation PASSED                                                                                                                           [ 60%] 
tests/test_salon_settings.py::TestSalonSettingsForm::test_get_opening_hours_dict PASSED                                                                                                                          [ 62%] 
tests/test_salon_settings.py::TestSalonSettingsAdminRoutes::test_salon_settings_page_access_denied PASSED                                                                                                        [ 64%] 
tests/test_salon_settings.py::TestSalonSettingsAdminRoutes::test_salon_settings_page_requires_manager_role PASSED                                                                                                [ 66%] 
tests/test_salon_settings.py::TestSalonSettingsAdminRoutes::test_salon_settings_form_submission FAILED                                                                                                           [ 68%] 
tests/test_salon_settings.py::TestSalonSettingsAdminRoutes::test_salon_settings_form_validation_error FAILED                                                                                                     [ 70%] 
tests/test_work_patterns.py::TestWorkPatternModel::test_work_pattern_creation PASSED                                                                                                                             [ 72%] 
tests/test_work_patterns.py::TestWorkPatternModel::test_get_weekly_hours PASSED                                                                                                                                  [ 74%] 
tests/test_work_patterns.py::TestWorkPatternModel::test_get_weekly_hours_partial_days PASSED                                                                                                                     [ 76%] 
tests/test_work_patterns.py::TestWorkPatternModel::test_get_weekly_hours_no_working_days PASSED                                                                                                                  [ 78%] 
tests/test_work_patterns.py::TestWorkPatternForm::test_valid_work_pattern_form PASSED                                                                                                                            [ 80%] 
tests/test_work_patterns.py::TestWorkPatternForm::test_invalid_time_format FAILED                                                                                                                                [ 82%] 
tests/test_work_patterns.py::TestWorkPatternForm::test_non_working_day_validation PASSED                                                                                                                         [ 84%] 
tests/test_work_patterns.py::TestWorkPatternForm::test_get_work_schedule_dict PASSED                                                                                                                             [ 86%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_work_patterns_page_access_denied PASSED                                                                                                            [ 88%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_work_patterns_page_requires_manager_role PASSED                                                                                                    [ 90%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_new_work_pattern_page PASSED                                                                                                                       [ 92%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_create_work_pattern PASSED                                                                                                                         [ 94%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_edit_work_pattern FAILED                                                                                                                           [ 96%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_delete_work_pattern PASSED                                                                                                                         [ 98%] 
tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_work_pattern_form_validation_error PASSED                                                                                                          [100%] 
                                                                                                                                                                                                                        
======================================================================================================= FAILURES =======================================================================================================
__________________________________________________________________________ TestEmploymentDetailsForm.test_commission_not_allowed_for_employed __________________________________________________________________________
tests/test_employment_details.py:219: in test_commission_not_allowed_for_employed                                                                                                                                       
    assert 'commission_percentage' in str(form.errors)                                                                                                                                                                  
E   AssertionError: assert 'commission_percentage' in '{}'                                                                                                                                                              
E    +  where '{}' = str({})                                                                                                                                                                                            
E    +    where {} = <app.forms.EmploymentDetailsForm object at 0x779bd19057c0>.errors                                                                                                                                  
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
_____________________________________________________________________________ TestEmploymentDetailsForm.test_invalid_commission_percentage _____________________________________________________________________________
tests/test_employment_details.py:234: in test_invalid_commission_percentage                                                                                                                                             
    assert 'commission_percentage' in str(form.errors)                                                                                                                                                                  
E   AssertionError: assert 'commission_percentage' in '{}'                                                                                                                                                              
E    +  where '{}' = str({})                                                                                                                                                                                            
E    +    where {} = <app.forms.EmploymentDetailsForm object at 0x779bd1988b20>.errors                                                                                                                                  
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
____________________________________________________________________________ TestEmploymentDetailsForm.test_negative_commission_percentage _____________________________________________________________________________
tests/test_employment_details.py:249: in test_negative_commission_percentage                                                                                                                                            
    assert 'commission_percentage' in str(form.errors)                                                                                                                                                                  
E   AssertionError: assert 'commission_percentage' in '{}'                                                                                                                                                              
E    +  where '{}' = str({})                                                                                                                                                                                            
E    +    where {} = <app.forms.EmploymentDetailsForm object at 0x779bd188b4f0>.errors                                                                                                                                  
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
____________________________________________________________________________ TestEmploymentDetailsAdminRoutes.test_edit_employment_details _____________________________________________________________________________
tests/test_employment_details.py:399: in test_edit_employment_details                                                                                                                                                   
    assert details.employment_type == 'self_employed'                                                                                                                                                                   
E   AssertionError: assert 'employed' == 'self_employed'                                                                                                                                                                
E                                                                                                                                                                                                                       
E     - self_employed                                                                                                                                                                                                   
E     ? -----                                                                                                                                                                                                           
E     + employed                                                                                                                                                                                                        
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
____________________________________________________________________________________ TestSalonSettingsForm.test_invalid_time_format ____________________________________________________________________________________
tests/test_salon_settings.py:192: in test_invalid_time_format                                                                                                                                                           
    assert 'monday_open' in str(form.errors)                                                                                                                                                                            
E   AssertionError: assert 'monday_open' in '{}'                                                                                                                                                                        
E    +  where '{}' = str({})                                                                                                                                                                                            
E    +    where {} = <app.forms.SalonSettingsForm object at 0x779bd167e700>.errors                                                                                                                                      
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
___________________________________________________________________________ TestSalonSettingsAdminRoutes.test_salon_settings_form_submission ___________________________________________________________________________
tests/test_salon_settings.py:330: in test_salon_settings_form_submission                                                                                                                                                
    assert settings.salon_name == 'Updated Salon Name'                                                                                                                                                                  
E   AssertionError: assert 'Salon ESE' == 'Updated Salon Name'                                                                                                                                                          
E                                                                                                                                                                                                                       
E     - Updated Salon Name                                                                                                                                                                                              
E     + Salon ESE                                                                                                                                                                                                       
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
________________________________________________________________________ TestSalonSettingsAdminRoutes.test_salon_settings_form_validation_error ________________________________________________________________________
tests/test_salon_settings.py:369: in test_salon_settings_form_validation_error                                                                                                                                          
    assert response.status_code == 200  # Form should be re-displayed with errors                                                                                                                                       
E   assert 302 == 200                                                                                                                                                                                                   
E    +  where 302 = <WrapperTestResponse streamed [302 FOUND]>.status_code                                                                                                                                              
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
_____________________________________________________________________________________ TestWorkPatternForm.test_invalid_time_format _____________________________________________________________________________________
tests/test_work_patterns.py:262: in test_invalid_time_format                                                                                                                                                            
    assert 'monday_start' in str(form.errors)                                                                                                                                                                           
E   AssertionError: assert 'monday_start' in '{}'                                                                                                                                                                       
E    +  where '{}' = str({})                                                                                                                                                                                            
E    +    where {} = <app.forms.WorkPatternForm object at 0x779bd12ded30>.errors                                                                                                                                        
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
__________________________________________________________________________________ TestWorkPatternAdminRoutes.test_edit_work_pattern ___________________________________________________________________________________
tests/test_work_patterns.py:484: in test_edit_work_pattern                                                                                                                                                              
    assert pattern.pattern_name == 'Updated Pattern'                                                                                                                                                                    
E   AssertionError: assert 'Original Pattern' == 'Updated Pattern'                                                                                                                                                      
E                                                                                                                                                                                                                       
E     - Updated Pattern                                                                                                                                                                                                 
E     + Original Pattern                                                                                                                                                                                                
------------------------------------------------------------------------------------------------ Captured stdout setup -------------------------------------------------------------------------------------------------
Database initialization attempt 1/5                                                                                                                                                                                     
✓ Tables created successfully                                                                                                                                                                                           
✓ Added role: guest                                                                                                                                                                                                     
✓ Added role: customer                                                                                                                                                                                                  
✓ Added role: stylist                                                                                                                                                                                                   
✓ Added role: manager                                                                                                                                                                                                   
✓ Added role: owner                                                                                                                                                                                                     
✓ Database initialization completed successfully                                                                                                                                                                        
=================================================================================================== warnings summary ===================================================================================================
tests/test_auth.py::test_user_registration                                                                                                                                                                              
  /app/app/routes/auth.py:66: RemovedIn20Warning: Deprecated API features detected! These feature(s) are not compatible with SQLAlchemy 2.0. To prevent incompatible upgrades prior to updating applications, ensure req
uirements files are pinned to "sqlalchemy<2.0". Set environment variable SQLALCHEMY_WARN_20=1 to show all deprecation warnings.  Set environment variable SQLALCHEMY_SILENCE_UBER_WARNING=1 to silence this message. (Ba
ckground on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)                                                                                                                                                              
    user.roles.append(owner_role)                                                                                                                                                                                       
                                                                                                                                                                                                                        
tests/test_employment_details.py::TestEmploymentDetailsModel::test_employment_details_creation_employed                                                                                                                 
  /app/tests/test_employment_details.py:103: SAWarning: Dialect sqlite+pysqlite does *not* support Decimal objects natively, and SQLAlchemy must convert from floating point - rounding errors and other issues may occu
r. Please consider storing Decimal numbers as strings or integers on this platform for lossless storage.                                                                                                                
    assert details.id is not None                                                                                                                                                                                       
                                                                                                                                                                                                                        
tests/test_employment_details.py::TestEmploymentDetailsModel::test_employment_details_creation_self_employed                                                                                                            
  /app/tests/test_employment_details.py:125: SAWarning: Dialect sqlite+pysqlite does *not* support Decimal objects natively, and SQLAlchemy must convert from floating point - rounding errors and other issues may occu
r. Please consider storing Decimal numbers as strings or integers on this platform for lossless storage.                                                                                                                
    assert details.id is not None                                                                                                                                                                                       
                                                                                                                                                                                                                        
tests/test_employment_details.py: 10 warnings                                                                                                                                                                           
  /app/app/forms.py:682: SAWarning: Dialect sqlite+pysqlite does *not* support Decimal objects natively, and SQLAlchemy must convert from floating point - rounding errors and other issues may occur. Please consider s
toring Decimal numbers as strings or integers on this platform for lossless storage.                                                                                                                                    
    existing = EmploymentDetails.query.filter_by(user_id=field.data).first()                                                                                                                                            
                                                                                                                                                                                                                        
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_employment_details_page_requires_manager_role                                                                                                  
  /app/app/routes/admin.py:294: SAWarning: Dialect sqlite+pysqlite does *not* support Decimal objects natively, and SQLAlchemy must convert from floating point - rounding errors and other issues may occur. Please con
sider storing Decimal numbers as strings or integers on this platform for lossless storage.                                                                                                                             
    details = db.session.query(EmploymentDetails, User).join(                                                                                                                                                           
                                                                                                                                                                                                                        
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_edit_employment_details                                                                                                                        
  /app/tests/test_employment_details.py:377: SAWarning: Dialect sqlite+pysqlite does *not* support Decimal objects natively, and SQLAlchemy must convert from floating point - rounding errors and other issues may occu
r. Please consider storing Decimal numbers as strings or integers on this platform for lossless storage.                                                                                                                
    details_id = details.id                                                                                                                                                                                             
                                                                                                                                                                                                                        
tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_delete_employment_details                                                                                                                      
  /app/tests/test_employment_details.py:416: SAWarning: Dialect sqlite+pysqlite does *not* support Decimal objects natively, and SQLAlchemy must convert from floating point - rounding errors and other issues may occu
r. Please consider storing Decimal numbers as strings or integers on this platform for lossless storage.                                                                                                                
    details_id = details.id                                                                                                                                                                                             
                                                                                                                                                                                                                        
-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html                                                                                                                                                 
                                                                                                                                                                                                                        
---------- coverage: platform linux, python 3.9.23-final-0 -----------                                                                                                                                                  
Name                         Stmts   Miss  Cover                                                                                                                                                                        
------------------------------------------------                                                                                                                                                                        
app/__init__.py                 61      8    87%                                                                                                                                                                        
app/extensions.py               10      0   100%                                                                                                                                                                        
app/forms.py                   568    152    73%                                                                                                                                                                        
app/models.py                  282     56    80%                                                                                                                                                                        
app/routes/__init__.py           0      0   100%                                                                                                                                                                        
app/routes/admin.py            228     91    60%                                                                                                                                                                        
app/routes/appointments.py     215    159    26%                                                                                                                                                                        
app/routes/auth.py              61      9    85%                                                                                                                                                                        
app/routes/main.py              57     31    46%                                                                                                                                                                        
app/routes/profile.py           95     76    20%                                                                                                                                                                        
app/utils.py                    95     76    20%                                                                                                                                                                        
------------------------------------------------                                                                                                                                                                        
TOTAL                         1672    658    61%                                                                                                                                                                        
                                                                                                                                                                                                                        
=============================================================================================== short test summary info ================================================================================================
FAILED tests/test_employment_details.py::TestEmploymentDetailsForm::test_commission_not_allowed_for_employed - AssertionError: assert 'commission_percentage' in '{}'                                                   
FAILED tests/test_employment_details.py::TestEmploymentDetailsForm::test_invalid_commission_percentage - AssertionError: assert 'commission_percentage' in '{}'                                                         
FAILED tests/test_employment_details.py::TestEmploymentDetailsForm::test_negative_commission_percentage - AssertionError: assert 'commission_percentage' in '{}'                                                        
FAILED tests/test_employment_details.py::TestEmploymentDetailsAdminRoutes::test_edit_employment_details - AssertionError: assert 'employed' == 'self_employed'                                                          
FAILED tests/test_salon_settings.py::TestSalonSettingsForm::test_invalid_time_format - AssertionError: assert 'monday_open' in '{}'                                                                                     
FAILED tests/test_salon_settings.py::TestSalonSettingsAdminRoutes::test_salon_settings_form_submission - AssertionError: assert 'Salon ESE' == 'Updated Salon Name'                                                     
FAILED tests/test_salon_settings.py::TestSalonSettingsAdminRoutes::test_salon_settings_form_validation_error - assert 302 == 200                                                                                        
FAILED tests/test_work_patterns.py::TestWorkPatternForm::test_invalid_time_format - AssertionError: assert 'monday_start' in '{}'                                                                                       
FAILED tests/test_work_patterns.py::TestWorkPatternAdminRoutes::test_edit_work_pattern - AssertionError: assert 'Original Pattern' == 'Updated Pattern'                                                                 
====================================================================================== 9 failed, 41 passed, 16 warnings in 8.31s =======================================================================================
                                                                                                                                                                                                                        
Chris.Stephens@FF-DT-08 c:\devroot\salon-ese                                                                                                                                                                            
#                                                                                                                                                                                                                       